<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Anomaly Detection in Blockchain - Double Spending</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script defer src="{{ url_for('static', filename='app.js') }}"></script>
</head>
<body>
  <header class="site-header">
    <div class="header-container">
      <div class="instructor-info">
        <img src="{{ url_for('static', filename='vu_logo.png') }}" alt="VU Logo" class="logo">
        <p><strong>Project Instructor:</strong> Fouzia Jumani</p>
        <p>Skype: fouziajumani</p>
        <p>Email: fouziajumani@vu.edu.pk</p>
      </div>

      <div class="title-box">
        <h1>Anomaly Detection System in Blockchain</h1>
        <h2>Prototype: Double Spending Attack Simulation</h2>
      </div>

      <div class="author-info">
        <img src="{{ url_for('static', filename='student_pic.png') }}" alt="Author Pic" class="student-pic">
        <p><strong>Project Author:</strong> Eng.Muhammad Imtiaz Shaffi</p>
        <p>VU ID: BC220200917</p>
        <p>Email: bc220200917mis@vu.edu.pk</p>
      </div>
    </div>
  </header>

  <main class="container">
    <div class="header-text">
      <h2>Prototype: Double Spending Attack Simulation</h2>
      <p>This prototype demonstrates a simple blockchain network and a double-spending attack simulation with comprehensive analytics.</p>
      <!-- Charts dashboard toggle button will be added by JavaScript -->
    </div>

    <hr>

    <!-- Charts Dashboard Section (will be populated by JavaScript) -->
    <div id="charts-dashboard"></div>

    <h3>-: Custom Blockchain :-</h3>

    <div class="section-box">
      <h4>Create New Transaction</h4>
      <div id="tx-form">
        <div class="form-group">
          <label for="tx-sender">Sender:</label>
          <input type="text" id="tx-sender" placeholder="e.g., Ali" required>
        </div>
        <div class="form-group">
          <label for="tx-receiver">Receiver:</label>
          <input type="text" id="tx-receiver" placeholder="e.g., Babar" required>
        </div>
        <div class="form-group">
          <label for="tx-amount">Amount:</label>
          <input type="number" id="tx-amount" placeholder="e.g., 10" step="any" required>
        </div>
        <button type="button" id="submit-tx-btn" class="primary-btn">Submit Transaction</button>
      </div>
      <pre id="tx-response" class="result-box" style="display:none;"></pre>
    </div>

    <div class="section-box">
      <h4>Mine Pending Transactions</h4>
      <div class="form-group">
        <label for="miner-name">Miner Name:</label>
        <input type="text" id="miner-name" placeholder="e.g., Miner1">
      </div>
      <button id="mine-btn" class="primary-btn">Mine Block</button>
      <pre id="mine-response" class="result-box" style="display:none;"></pre>
    </div>

    <div class="section-box">
      <h4>Current Balances</h4>
      <button id="refresh-balances-btn" class="primary-btn">Refresh Balances</button>
      <pre id="balances-output"></pre>
    </div>

    <div class="section-box">
      <h4>Blockchain Chain</h4>
      <button id="refresh-chain-btn" class="primary-btn">Refresh Chain</button>
      <pre id="chain-output"></pre>

      <div id="chain-chart-container" style="margin-top:20px; display:none;">
        <h4>Blockchain Growth Chart</h4>
        <canvas id="chainChart"></canvas>
      </div>
    </div>

    <div class="section-box">
      <h4>Run Double-Spending Attack </h4>

      <div class="attack-controls">
        <h4>üéÆ Attack Control Panel</h4>

        <div class="control-group">
          <label>Success Probability: <span id="probability-value" class="slider-value">50%</span></label>
          <div class="slider-container">
            <input type="range" min="1" max="100" value="50"
                   oninput="updateSuccessProbability(this.value)">
          </div>
        </div>

        <div class="control-group">
          <label>Attacker Hash Power: <span id="hashpower-value" class="slider-value">30%</span></label>
          <div class="slider-container">
            <input type="range" min="1" max="100" value="30"
                   oninput="updateHashPower(this.value)">
          </div>
        </div>

        <div class="control-group">
          <label>Force Outcome:</label>
          <div class="force-buttons">
            <button id="force-success-btn" class="force-btn" onclick="forceAttackSuccess()">
              ‚úÖ Force Success
            </button>
            <button id="force-failure-btn" class="force-btn" onclick="forceAttackFailure()">
              ‚ùå Force Failure
            </button>
            <button class="force-btn" onclick="resetAttackControl()">
              üîÑ Random
            </button>
          </div>
        </div>

        <div class="control-status">
          <strong>Current Mode:</strong>
          <span id="current-mode">Random (Based on probability and hash power)</span>
        </div>
      </div>

      <div class="form-group">
        <label>Attacker Name</label>
        <input id="attack-attacker" placeholder="Attacker1">
        <label>Private Blocks to Mine</label>
        <input id="attack-blocks" type="number" value="1">
        <label>Amount</label>
        <input id="attack-amount" type="number" value="10" step="any">
      </div>
      <button id="run-attack-btn" class="primary-btn">Run Attack</button>
      <pre id="attack-output" class="result-box" style="display:none;"></pre>
    </div>

    <hr>

    <h3>-: P2P Network :-</h3>

    <div class="section-box">
        <h4>Register a New Peer</h4>
        <div class="form-group">
            <label for="peer-address">Peer Address:</label>
            <input type="text" id="peer-address" placeholder="e.g., http://127.0.0.1:5001" required>
        </div>
        <button id="add-peer-btn" class="primary-btn">Add Peer</button>
        <pre id="peer-response" class="result-box" style="display:none;"></pre>
    </div>

    <div class="section-box">
        <h4>Resolve Network Conflicts</h4>
        <p>Fetch the longest chain from all known peers and replace our chain if it's shorter.</p>
        <button id="resolve-conflicts-btn" class="primary-btn">Run Consensus</button>
        <pre id="consensus-response" class="result-box" style="display:none;"></pre>
    </div>

    <hr>

    <h3>-: SimBlock Simulation :-</h3>
    <button id="run-analysis-btn" class="primary-btn">Run Simulation</button>
    <div id="loading-spinner" class="spinner" style="display:none;">‚è≥ Running...</div>

    <div id="simulation-summary" class="result-box" style="display:none;">
      <h3>Simulation Summary</h3>
      <table id="summary-table">
        <thead>
          <tr>
            <th>Metric</th>
            <th>Value</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div id="simblock-chart-container" style="margin-top:20px;">
        <h4>Simulation Stats Chart</h4>
        <canvas id="simblockChart"></canvas>
      </div>
    </div>

    <hr>

    <button id="download-report-btn" class="primary-btn">Download Comprehensive PDF Report</button>
    <div id="pdf-spinner" class="spinner" style="display:none;">‚è≥ Generating PDF...</div>
  </main>

  <footer class="site-footer">
    <div class="footer-container">
      <p>¬© 2025 This project is developed under the supervision of Virtual University of Pakistan</p>
    </div>
  </footer>
</body>
</html>